# INAV 9.0.0-RC4 Master Release Checklist

**Created:** 2025-12-23
**Release Manager:** Claude
**Type:** Pre-release (Release Candidate 4)
**Branch:** maintenance-9.x (for both repositories)

---

## CRITICAL PRINCIPLE: Verify Builds BEFORE Creating Tags

**Never tag a commit that hasn't been proven to build successfully.**

The phases in this checklist are ordered so that:
1. CI is verified FIRST (Phase 0)
2. Artifacts are downloaded and verified (Phases 2-4)
3. Tags and releases are created LAST (Phase 5)

If ANY build fails or verification fails, **STOP** and fix the issue before proceeding.

---

## PHASE 0: Pre-Release Preparation

### 0.0 CRITICAL Prerequisites
- [ ] **PR #2496 MERGED** - Fix SITL binary path resolution (required for Windows SITL)
  - Check: `gh pr view 2496 --repo iNavFlight/inav-configurator --json state`
  - If OPEN: **STOP** - Cannot proceed until merged to maintenance-9.x

### 0.1 Repository Status Assessment
- [ ] Fetch latest from upstream: `git fetch upstream`
- [ ] Identify target commits on maintenance-9.x for both repos
- [ ] Document all PRs/commits since RC3
- [ ] **Verify ALL CI jobs passed** on target commits (not just some jobs)
  - If ANY job failed: **STOP** - fix before proceeding
  - Record CI run IDs for artifact download

### 0.2 Version Number Verification
- [ ] Firmware version in `CMakeLists.txt` is 9.0.0
- [ ] Configurator version in `package.json` is 9.0.0
- [ ] Versions match between repositories

### 0.3 SITL Binary Update (if needed)
- [ ] Check if firmware SITL has changed since RC3
- [ ] If changed: Build/download new SITL binaries for all platforms
- [ ] If changed: Create PR to update SITL in configurator
- [ ] If changed: Wait for PR to merge before proceeding

---

## PHASE 1: Documentation Preparation

### 1.1 Release Notes
- [ ] Draft RC4-specific changes section
- [ ] Copy RC3 release notes as base (cumulative format)
- [ ] Add "Changes in RC4 (from RC3)" section at top
- [ ] Create `9.0.0-RC4-firmware-release-notes.md`
- [ ] Create `9.0.0-RC4-configurator-release-notes.md`

### 1.2 Wiki Update
- [ ] Update `inavwiki/9.0.0-Release-Notes.md` with RC4 changes
- [ ] Commit wiki changes

### 1.3 Incompatible Settings Check
- [ ] Run `./find-incompatible-settings.sh 8.0.1 maintenance-9.x`
- [ ] Verify all incompatible settings are documented in release notes
- [ ] No new incompatibilities since RC3 (or document if any)

---

## PHASE 2: Artifact Collection

### 2.1 Firmware Artifacts
- [ ] Identify matching nightly build on inav-nightly
- [ ] Download all hex files from nightly
- [ ] Verify hex file count matches expected targets (~219)
- [ ] Rename files using `rename-firmware-for-release.sh 9.0.0-RC4`
- [ ] Store in `downloads/firmware-9.0.0-RC4/`

### 2.2 Configurator Artifacts
- [ ] Identify CI run for target configurator commit
- [ ] Download all platform artifacts
- [ ] **CRITICAL: Organize by platform** (linux/, macos/, windows/)
- [ ] Store in `downloads/configurator-9.0.0-RC4/`

### 2.3 Configurator File Inventory
Expected files (14 total):

**Linux (6 files):**
- [ ] INAV-Configurator_linux_arm64_9.0.0.AppImage
- [ ] INAV-Configurator_linux_arm64_9.0.0.deb
- [ ] INAV-Configurator_linux_arm64_9.0.0.rpm
- [ ] INAV-Configurator_linux_x64_9.0.0.AppImage
- [ ] INAV-Configurator_linux_x64_9.0.0.deb
- [ ] INAV-Configurator_linux_x64_9.0.0.rpm

**macOS (4 files):**
- [ ] INAV-Configurator_macOS_arm64_9.0.0.dmg
- [ ] INAV-Configurator_macOS_arm64_9.0.0.zip
- [ ] INAV-Configurator_macOS_x64_9.0.0.dmg
- [ ] INAV-Configurator_macOS_x64_9.0.0.zip

**Windows (4 files):**
- [ ] INAV-Configurator_win_x64_9.0.0.exe
- [ ] INAV-Configurator_win_x64_9.0.0.msi
- [ ] INAV-Configurator_win_x64_9.0.0.zip
- [ ] INAV-Configurator_win_x64_9.0.0.exe.blockmap

---

## PHASE 3: Artifact Verification (CRITICAL)

### 3.1 macOS DMG Verification
- [ ] Run `./verify-dmg-contents.sh downloads/configurator-9.0.0-RC4/macos/*.dmg`
- [ ] Confirm: NO Windows files (.exe, .dll, .msi) found
- [ ] Confirm: Valid Mach-O executable format
- [ ] Confirm: Correct architecture (arm64 vs x64)
- [ ] Document verification results

### 3.2 Windows SITL Verification (NEW - Critical for SITL functionality)
- [ ] Extract Windows zip to temp location
- [ ] **VERIFY cygwin1.dll EXISTS** in `resources/sitl/windows/` (packaged path per PR #2496)
- [ ] Verify inav_SITL.exe exists in same directory
- [ ] Document: cygwin1.dll size and presence confirmed
- [ ] If cygwin1.dll missing: STOP - escalate to developer

```bash
# Verification command:
unzip -l downloads/configurator-9.0.0-RC4/windows/*_9.0.0.zip | grep -E "(cygwin1.dll|inav_SITL.exe)"

# Or use the verification script:
./verify-windows-sitl.sh downloads/configurator-9.0.0-RC4/windows/*_9.0.0.zip
```

### 3.3 Linux SITL glibc Verification
- [ ] Check glibc requirement of Linux x64 SITL binary
- [ ] Check glibc requirement of Linux arm64 SITL binary
- [ ] Verify glibc version is <= 2.35 (Ubuntu 22.04 LTS compatibility)
- [ ] If glibc > 2.35: STOP - binary won't work on Ubuntu 22.04 LTS

```bash
# Extract Linux configurator and check SITL binary glibc requirement
# Should output 2.35 or lower for Ubuntu 22.04 LTS compatibility
objdump -T resources/sitl/linux/inav_SITL | grep GLIBC | sed 's/.*GLIBC_//;s/ .*//' | sort -V | tail -1
```

### 3.4 Firmware Hex File Verification
- [ ] Count hex files matches target count (~219)
- [ ] Verify naming convention: `inav_9.0.0_RC4_TARGET.hex`
- [ ] Spot-check a few file sizes (should be >100KB typically)

---

## PHASE 4: SITL Testing

### 4.1 Linux SITL Test
- [ ] Extract Linux configurator package
- [ ] Launch configurator
- [ ] Start SITL from within configurator
- [ ] Verify SITL connects successfully
- [ ] Verify firmware version shows 9.0.0

### 4.2 Windows SITL Test (if Windows available)
- [ ] Extract Windows zip
- [ ] Verify cygwin1.dll present in sitl/windows/
- [ ] Launch configurator
- [ ] Start SITL
- [ ] Verify SITL runs without "cygwin1.dll not found" error

---

## PHASE 5: Release Creation

### 5.1 Create Draft Releases
- [ ] Create firmware draft release with `gh release create`
- [ ] Create configurator draft release with `gh release create`
- [ ] Both set as pre-release and draft

### 5.2 Upload Artifacts

**Firmware:**
- [ ] Upload all hex files to firmware release
- [ ] Verify upload count matches file count

**Configurator:**
- [ ] Upload Linux files
- [ ] Upload macOS files
- [ ] Upload Windows files
- [ ] Verify upload count (14 files)

### 5.3 Review Draft Releases

**Firmware Release Check:**
- [ ] Release notes display correctly
- [ ] Pre-release flag is set
- [ ] All hex files uploaded
- [ ] Tag points to correct commit
- [ ] Title is "INAV 9.0.0-RC4 release candidate for testing"

**Configurator Release Check:**
- [ ] Release notes display correctly
- [ ] Pre-release flag is set
- [ ] All 14 files uploaded with correct names
- [ ] Tag points to correct commit
- [ ] Title is "INAV Configurator 9.0.0-RC4 release candidate for testing"

---

## PHASE 6: Publication

### 6.1 Final Pre-Publish Checklist
- [ ] Both draft releases reviewed
- [ ] All artifacts verified
- [ ] macOS DMG verification passed
- [ ] Windows SITL cygwin1.dll verified
- [ ] SITL tested and working
- [ ] Release notes are cumulative (RC4 + RC3 + RC2 + RC1)
- [ ] Tags point to correct commits

### 6.2 Publish
- [ ] Publish firmware release: `gh release edit 9.0.0-RC4 --repo iNavFlight/inav --draft=false`
- [ ] Publish configurator release: `gh release edit 9.0.0-RC4 --repo iNavFlight/inav-configurator --draft=false`

### 6.3 Post-Publish Verification
- [ ] Download a firmware hex from live release - verify it works
- [ ] Download configurator from live release - verify it runs
- [ ] Verify release links are accessible

---

## PHASE 7: Post-Release

### 7.1 Announcements
- [ ] Announce on Discord
- [ ] Update any pinned issues if applicable

### 7.2 Monitoring
- [ ] Monitor for critical bug reports (first 24-48 hours)
- [ ] Document any issues found

### 7.3 Documentation
- [ ] Archive this checklist as completed
- [ ] Document any lessons learned
- [ ] Update README.md if process improvements identified

---

## Quick Reference: Key Commands

```bash
# Fetch latest
cd inav && git fetch upstream
cd ../inav-configurator && git fetch upstream

# Check commits since RC3
git log 9.0.0-RC3..upstream/maintenance-9.x --oneline

# Download configurator artifacts
gh run download <run-id> --repo iNavFlight/inav-configurator

# Download firmware from nightly
gh release download <tag> --repo iNavFlight/inav-nightly --pattern "*.hex"

# Rename firmware files
./rename-firmware-for-release.sh 9.0.0-RC4 downloads/firmware-9.0.0-RC4/

# Verify macOS DMGs
./verify-dmg-contents.sh downloads/configurator-9.0.0-RC4/macos/*.dmg

# Verify Windows SITL has cygwin1.dll
unzip -l downloads/configurator-9.0.0-RC4/windows/*_9.0.0.zip | grep cygwin1.dll

# Create releases
gh release create 9.0.0-RC4 --repo iNavFlight/inav --target <commit> --title "..." --notes-file ... --prerelease --draft
gh release create 9.0.0-RC4 --repo iNavFlight/inav-configurator --target <commit> --title "..." --notes-file ... --prerelease --draft

# Upload artifacts
gh release upload 9.0.0-RC4 *.hex --repo iNavFlight/inav
gh release upload 9.0.0-RC4 linux/* macos/* windows/* --repo iNavFlight/inav-configurator

# Publish
gh release edit 9.0.0-RC4 --repo iNavFlight/inav --draft=false
gh release edit 9.0.0-RC4 --repo iNavFlight/inav-configurator --draft=false
```

---

## Escalation Points

| Issue | Escalate To | Action |
|-------|-------------|--------|
| cygwin1.dll missing from Windows build | Developer | Hold release, investigate build |
| macOS DMG contains Windows files | Developer | Hold release, rebuild configurator |
| SITL version mismatch | Developer | SITL update PR needed |
| CI failures on maintenance-9.x | Developer | Fix before proceeding |
| Critical bug in RC3 unfixed | Manager | Delay or emergency fix |

---

**Remember:** This is a systematic, disciplined release. Check every box. Skip nothing.
