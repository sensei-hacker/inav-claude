# INAV 9.0.0-RC4 Release Plan

**Created:** 2025-12-23
**Release Manager:** Claude
**Type:** Pre-release (Release Candidate 4)
**Status:** PLANNING

---

## CRITICAL PRINCIPLE: Verify Builds BEFORE Creating Tags

**Never tag a commit that hasn't been proven to build successfully.**

Order of operations:
1. Identify target commit
2. Verify ALL CI jobs passed for that commit
3. Download and verify artifacts from that CI run
4. **Only then** create tag pointing to the verified commit

If CI fails, fix the issue first. Do not tag broken commits.

---

## Target Commits

**NOTE:** These commits are CANDIDATES. They will only be tagged after CI is verified as passing.

### Firmware
- **Repository:** iNavFlight/inav
- **Branch:** maintenance-9.x
- **Commit:** `880c89a44abf972aa0ff0f872947d6e147ab4f59`
- **Short SHA:** `880c89a4`

### Configurator
- **Repository:** iNavFlight/inav-configurator
- **Branch:** maintenance-9.x
- **Commit:** `5bf903c4aca5fcff7375cdadb64f6b5a3dcbeabd`
- **Short SHA:** `5bf903c4`

---

## Changes Since RC3

### Firmware Changes (8 PRs)

#### Bug Fixes
1. **PR #11194** - Fix H743 USB MSC standalone mode (@sensei-hacker)
   - Fix H7 SDIO alignment issue and add retry logic
   - Add timeout protection to USB MSC read/write loops
   - Critical fix for USB mass storage on H7 boards

2. **PR #11172** - Fix cppcheck critical bugs (@sensei-hacker)
   - Fix CRSF buffer overflow
   - Fix dashboard sizeof bug
   - Fix integer overflow issues

#### New Features
3. **PR #11042** - Airspeed TPA support (@shota3527)
   - Add airspeed-based Throttle PID Attenuation
   - Enhance TPA with pitch angle awareness
   - Raise pitot_lpf_milli_hz

4. **PR #11173** - Logic conditions enabled mask (@sensei-hacker)
   - Add MSP2_INAV_LOGIC_CONDITIONS_CONFIGURED command
   - Guard if max conditions increased beyond 64

#### Hardware Support
5. **PR #11192** - OMNIBUSF4V3 ICM support (@wchnflr)
   - Update target configuration for ICM gyro variant

#### Documentation
6. **PR #11175** - JavaScript programming docs updates (@sensei-hacker)
   - Add new JS features (PID, flight modes, let/const, ternary)
   - Update to namespaced syntax

7. **PR #11187** - Power limiting documentation (@sensei-hacker)
   - Add power/current limiting docs to Battery.md
   - Fix formula divisor in calibration tips

8. **PR #11191** - Branching strategy documentation (@sensei-hacker)
   - Add branch propagation section
   - Simplify fork update instructions

### Configurator Changes (20+ PRs)

#### Critical Bug Fixes
1. **PR #2495** - Fix logic conditions loading error handler (@sensei-hacker)
   - Handle MSP errors properly during loading

2. **PR #2494** - Fix serial connection reliability (@sensei-hacker)
   - Fix serial port handle leak causing "Cannot lock port" errors
   - Critical reliability improvement

3. **PR #2476** - Fix serial port open (@error414)
   - Error handle fix for serial port open

4. **PR #2488** - Fix dialog undefined (@sensei-hacker)
   - Maintenance branch fix for undefined dialog

5. **PR #2489** - Fix auto-select target forEach (@sensei-hacker)
   - Improve forEach check with duck typing

#### Feature Improvements
6. **PR #2487** - Flight axis override implementation (@sensei-hacker)
   - Add backward compatibility for flight axis override

7. **PR #2474** - Transpiler additional overrides (@sensei-hacker)
   - Add ternary support, caching, pattern recognition
   - Many transpiler improvements

8. **PR #2466** - Progressive settings loading (@sensei-hacker)
   - Faster tab rendering with progressive loading

9. **PR #2465** - Logic conditions optimized load (@sensei-hacker)
   - Optimize with configured mask

10. **PR #2483** - Remote debugging support (@sensei-hacker)
    - Add Chrome DevTools Protocol support

11. **PR #2454** - Config 3D acceleration (@Scavanger)
    - Add option to disable 3D acceleration in settings

#### UI Fixes
12. **PR #2480** - Fix receiver MSP nouislider (@sensei-hacker)
    - Fix nouislider migration on receiver MSP page

13. **PR #2475** - Fix mixer motor number positioning (@sensei-hacker)
    - Fix motor number display in Mixer tab

14. **PR #2473** - Fix CLI clipboard (@sensei-hacker)
    - Enable clipboard support detection

15. **PR #2485** - Fix async settings triggers (@sensei-hacker)
    - Fix race condition in Configuration and Receiver tabs

#### Transpiler/Decompiler
16. **PR #2472** - Transpiler simplification review (@sensei-hacker)
    - Major refactoring and cleanup

17. **PR #2470** - Decompiler PID (@sensei-hacker)
    - Add PID examples and improvements

18. **PR #2490** - Fix Monaco autocomplete (@sensei-hacker)
    - Remove destructuring for compatibility

#### Translations
19. **PR #2491** - Ukrainian translations (@smsnvc)
    - Add missing translations for INAV 9 RC

20. **PR #2471** - Russian translation (@funkill)
    - Add Russian localization

---

## Pre-Release Requirements

### CRITICAL: PR #2496 Must Be Merged

**Status:** OPEN (as of 2025-12-23)
**PR:** https://github.com/iNavFlight/inav-configurator/pull/2496
**Title:** Fix SITL binary path resolution for dev and packaged modes

This PR is **REQUIRED** for Windows SITL to work. It:
- Adds `extraResource` config to include SITL binaries in packaged builds
- Adds `afterCopy` hook to remove other platforms' binaries
- Fixes path resolution so SITL can find its executables

**Without this PR merged, Windows SITL will be broken in RC4.**

Action: Ensure PR #2496 is merged to maintenance-9.x before proceeding with release.

---

### SITL Binary Update Assessment

**Question:** Have the firmware SITL binaries changed since RC3?

Check:
```bash
cd /home/raymorris/Documents/planes/inavflight/inav
git diff 9.0.0-RC3..upstream/maintenance-9.x -- src/main/target/SITL/
```

If SITL source has changed:
1. Need to build new SITL binaries for all platforms
2. Create PR to update SITL in configurator
3. Wait for PR to merge before tagging

If SITL source unchanged:
1. Configurator already has correct SITL binaries from RC3
2. Can proceed without SITL update

### Linux SITL glibc Compatibility

**CRITICAL:** Linux SITL binaries must be compiled with glibc <= 2.35 for Ubuntu 22.04 LTS compatibility.

| Period | Oldest Supported Ubuntu LTS | Required glibc |
|--------|----------------------------|----------------|
| 2025-2027 | Ubuntu 22.04.3 LTS | <= 2.35 |

Verification:
```bash
# Check max glibc version required by binary (should be 2.35 or lower)
objdump -T inav_SITL | grep GLIBC | sed 's/.*GLIBC_//;s/ .*//' | sort -V | tail -1
```

If the binary requires glibc > 2.35, it will fail on Ubuntu 22.04 with:
```
/lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.38' not found
```

---

### Windows SITL cygwin1.dll Verification

**CRITICAL:** Ensure cygwin1.dll is included in Windows configurator builds.

Current status in configurator repo:
```
resources/public/sitl/windows/
├── cygwin1.dll (2.95 MB)
└── inav_SITL.exe (1.52 MB)
```

Verification step during artifact collection:
```bash
unzip -l INAV-Configurator_win_x64_9.0.0.zip | grep -E "(cygwin1.dll|inav_SITL.exe)"
```

Expected output should show BOTH files present.

---

## Artifact Collection Plan

### Firmware Artifacts

1. **Find matching nightly build:**
   ```bash
   gh release list --repo iNavFlight/inav-nightly --limit 10
   ```

2. **Verify nightly matches target commit:**
   - Nightly should be built from commit `880c89a4` or later on maintenance-9.x

3. **Download hex files:**
   ```bash
   mkdir -p downloads/firmware-9.0.0-RC4
   cd downloads/firmware-9.0.0-RC4
   gh release download <nightly-tag> --repo iNavFlight/inav-nightly --pattern "*.hex"
   ```

4. **Rename files:**
   ```bash
   cd /home/raymorris/Documents/planes/inavflight/claude/release-manager
   ./rename-firmware-for-release.sh 9.0.0-RC4 downloads/firmware-9.0.0-RC4/
   ```

### Configurator Artifacts

1. **Find CI run for commit:**
   ```bash
   gh run list --repo iNavFlight/inav-configurator --limit 20 --json headSha,databaseId,status | \
     jq '.[] | select(.headSha | startswith("5bf903c4"))'
   ```

2. **Download artifacts:**
   ```bash
   mkdir -p downloads/configurator-9.0.0-RC4/{linux,macos,windows}
   gh run download <run-id> --repo iNavFlight/inav-configurator
   ```

3. **Organize by platform:**
   ```bash
   mv INAV-Configurator_linux*/* downloads/configurator-9.0.0-RC4/linux/
   mv INAV-Configurator_macOS*/* downloads/configurator-9.0.0-RC4/macos/
   mv INAV-Configurator_win*/* downloads/configurator-9.0.0-RC4/windows/
   ```

---

## Release Notes Strategy

### Cumulative Format

RC4 release notes will include:
1. **NEW:** Changes in RC4 (from RC3) - at top
2. Changes in RC3 (from RC2)
3. Changes in RC2 (from RC1)
4. Full RC1 content

### Files to Create

1. `9.0.0-RC4-firmware-release-notes.md`
2. `9.0.0-RC4-configurator-release-notes.md`

### Wiki Update

Update `inavwiki/9.0.0-Release-Notes.md`:
- Add "Changes in RC4" section at top
- Keep all previous RC sections

---

## Release Commands

### Create Draft Releases

```bash
# Firmware
gh release create 9.0.0-RC4 \
  --repo iNavFlight/inav \
  --target 880c89a44abf972aa0ff0f872947d6e147ab4f59 \
  --title "INAV 9.0.0-RC4 release candidate for testing" \
  --notes-file claude/release-manager/9.0.0-RC4-firmware-release-notes.md \
  --prerelease \
  --draft

# Configurator
gh release create 9.0.0-RC4 \
  --repo iNavFlight/inav-configurator \
  --target 5bf903c4aca5fcff7375cdadb64f6b5a3dcbeabd \
  --title "INAV Configurator 9.0.0-RC4 release candidate for testing" \
  --notes-file claude/release-manager/9.0.0-RC4-configurator-release-notes.md \
  --prerelease \
  --draft
```

### Upload Artifacts

```bash
cd claude/release-manager/downloads

# Configurator
gh release upload 9.0.0-RC4 configurator-9.0.0-RC4/linux/* --repo iNavFlight/inav-configurator
gh release upload 9.0.0-RC4 configurator-9.0.0-RC4/macos/* --repo iNavFlight/inav-configurator
gh release upload 9.0.0-RC4 configurator-9.0.0-RC4/windows/* --repo iNavFlight/inav-configurator

# Firmware
gh release upload 9.0.0-RC4 firmware-9.0.0-RC4/*.hex --repo iNavFlight/inav
```

### Publish

```bash
gh release edit 9.0.0-RC4 --repo iNavFlight/inav --draft=false
gh release edit 9.0.0-RC4 --repo iNavFlight/inav-configurator --draft=false
```

---

## Verification Checklist

### Pre-Upload
- [ ] Firmware hex files renamed correctly
- [ ] Configurator artifacts organized by platform
- [ ] macOS DMG verification passed
- [ ] Windows SITL cygwin1.dll verified present

### Post-Upload
- [ ] All firmware hex files uploaded (~219)
- [ ] All configurator files uploaded (14)
- [ ] Release notes display correctly
- [ ] Pre-release flag set
- [ ] Tags point to correct commits

### Post-Publish
- [ ] Can download firmware hex from release
- [ ] Can download configurator from release
- [ ] SITL works on at least one platform

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| cygwin1.dll missing | Low | High | Explicit verification step added |
| macOS DMG contamination | Low | High | DMG verification script |
| Wrong commit tagged | Low | High | Document exact SHAs, verify before publish |
| SITL version mismatch | Medium | Medium | Test SITL before publish |
| Missing hex files | Low | Medium | Count verification step |

---

## Timeline

1. **Phase 1: Preparation** (Current)
   - Create planning documents
   - Identify target commits
   - Document changes

2. **Phase 2: Artifact Collection**
   - Download nightly firmware
   - Download configurator CI artifacts
   - Organize and rename files

3. **Phase 3: Verification**
   - Run all verification scripts
   - Test SITL

4. **Phase 4: Release**
   - Create draft releases
   - Upload artifacts
   - Review and publish

5. **Phase 5: Post-Release**
   - Monitor for issues
   - Announce

---

## Notes

- This is a disciplined, systematic release. Every checkbox matters.
- The cygwin1.dll verification step is new for RC4 - added based on user feedback.
- Use the Master Checklist (`9.0.0-RC4-MASTER-CHECKLIST.md`) for step-by-step execution.
